import{bw as x}from"./index-BNUWbdM5.js";import{u as D}from"./auth-store-iwaO7pIV.js";const k={"Content-Type":"application/json"},F=/\{[^{}]+\}/g;class I extends Request{constructor(t,e){super(t,e);for(const n in e)n in this||(this[n]=e[n])}}function L(r){let{baseUrl:t="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:s,headers:o,...a}={...r};t.endsWith("/")&&(t=t.substring(0,t.length-1)),o=O(k,o);const c=[];async function f(l,i){const{fetch:b=e,headers:U,params:w={},parseAs:j="json",querySerializer:R,bodySerializer:T=s??W,...H}=i||{};let $=typeof n=="function"?n:z(n);R&&($=typeof R=="function"?R:z({...typeof n=="object"?n:{},...R}));const m={redirect:"follow",...a,...H,headers:O(o,U,w.header)};m.body&&(m.body=T(m.body)),m.body instanceof FormData&&m.headers.delete("Content-Type");let d=new I(v(l,{baseUrl:t,params:w,querySerializer:$}),m);const E={baseUrl:t,fetch:b,parseAs:j,querySerializer:$,bodySerializer:T};for(const y of c)if(y&&typeof y=="object"&&typeof y.onRequest=="function"){d.schemaPath=l,d.params=w;const h=await y.onRequest(d,E);if(h){if(!(h instanceof Request))throw new Error("Middleware must return new Request() when modifying the request");d=h}}let u=await b(d);for(let y=c.length-1;y>=0;y--){const h=c[y];if(h&&typeof h=="object"&&typeof h.onResponse=="function"){d.schemaPath=l,d.params=w;const S=await h.onResponse(u,E,d);if(S){if(!(S instanceof Response))throw new Error("Middleware must return new Response() when modifying the response");u=S}}}if(u.status===204||u.headers.get("Content-Length")==="0")return u.ok?{data:{},response:u}:{error:{},response:u};if(u.ok)return j==="stream"?{data:u.body,response:u}:{data:await u[j](),response:u};let A=await u.text();try{A=JSON.parse(A)}catch{}return{error:A,response:u}}return{async GET(l,i){return f(l,{...i,method:"GET"})},async PUT(l,i){return f(l,{...i,method:"PUT"})},async POST(l,i){return f(l,{...i,method:"POST"})},async DELETE(l,i){return f(l,{...i,method:"DELETE"})},async OPTIONS(l,i){return f(l,{...i,method:"OPTIONS"})},async HEAD(l,i){return f(l,{...i,method:"HEAD"})},async PATCH(l,i){return f(l,{...i,method:"PATCH"})},async TRACE(l,i){return f(l,{...i,method:"TRACE"})},use(...l){for(const i of l)if(i){if(typeof i!="object"||!("onRequest"in i||"onResponse"in i))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");c.push(i)}},eject(...l){for(const i of l){const b=c.indexOf(i);b!==-1&&c.splice(b,1)}}}}function g(r,t,e){if(t==null)return"";if(typeof t=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${r}=${e?.allowReserved===!0?t:encodeURIComponent(t)}`}function q(r,t,e){if(!t||typeof t!="object")return"";const n=[],s={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(const c in t)n.push(c,e.allowReserved===!0?t[c]:encodeURIComponent(t[c]));const a=n.join(",");switch(e.style){case"form":return`${r}=${a}`;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return a}}for(const a in t){const c=e.style==="deepObject"?`${r}[${a}]`:a;n.push(g(c,t[a],e))}const o=n.join(s);return e.style==="label"||e.style==="matrix"?`${s}${o}`:o}function C(r,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){const o={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?t:t.map(c=>encodeURIComponent(c))).join(o);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return`${r}=${a}`}}const n={simple:",",label:".",matrix:";"}[e.style]||"&",s=[];for(const o of t)e.style==="simple"||e.style==="label"?s.push(e.allowReserved===!0?o:encodeURIComponent(o)):s.push(g(r,o,e));return e.style==="label"||e.style==="matrix"?`${n}${s.join(n)}`:s.join(n)}function z(r){return function(e){const n=[];if(e&&typeof e=="object")for(const s in e){const o=e[s];if(o!=null){if(Array.isArray(o)){n.push(C(s,o,{style:"form",explode:!0,...r?.array,allowReserved:r?.allowReserved||!1}));continue}if(typeof o=="object"){n.push(q(s,o,{style:"deepObject",explode:!0,...r?.object,allowReserved:r?.allowReserved||!1}));continue}n.push(g(s,o,r))}}return n.join("&")}}function M(r,t){let e=r;for(const n of r.match(F)??[]){let s=n.substring(1,n.length-1),o=!1,a="simple";if(s.endsWith("*")&&(o=!0,s=s.substring(0,s.length-1)),s.startsWith(".")?(a="label",s=s.substring(1)):s.startsWith(";")&&(a="matrix",s=s.substring(1)),!t||t[s]===void 0||t[s]===null)continue;const c=t[s];if(Array.isArray(c)){e=e.replace(n,C(s,c,{style:a,explode:o}));continue}if(typeof c=="object"){e=e.replace(n,q(s,c,{style:a,explode:o}));continue}if(a==="matrix"){e=e.replace(n,`;${g(s,c)}`);continue}e=e.replace(n,a==="label"?`.${c}`:c)}return e}function W(r){return JSON.stringify(r)}function v(r,t){let e=`${t.baseUrl}${r}`;t.params?.path&&(e=M(e,t.params.path));let n=t.querySerializer(t.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function O(...r){const t=new Headers;for(const e of r){if(!e||typeof e!="object")continue;const n=e instanceof Headers?e.entries():Object.entries(e);for(const[s,o]of n)if(o===null)t.delete(s);else if(Array.isArray(o))for(const a of o)t.append(s,a);else o!==void 0&&t.set(s,o)}return t}const N=D(),p={},_={async onRequest(r,t){return console.debug("Fetch: Request data from",r,t),p[r.url]="start",setTimeout(()=>{p[r.url]=="start"&&(p[r.url]="loading",x.start(),console.debug("  start loading bar"))},300),r},async onResponse(r,t){return console.debug("Fetch: Received data from",r,t),r.url in p&&p[r.url]=="loading"&&(x.stop(),console.debug("  stop loading bar")),p[r.url]="stopped",r}},B={async onRequest(r){const t=N.access_token;return t&&r.headers.set("Authorization",`Bearer ${t}`),r}},P=L({baseUrl:"https://api.wodore.com"});P.use(_);P.use(B);export{P as c};
