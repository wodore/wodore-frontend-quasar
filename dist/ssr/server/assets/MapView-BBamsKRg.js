import{defineComponent as F,inject as J,ref as m,watchEffect as N,resolveComponent as q,unref as o,mergeProps as Q,withCtx as x,createVNode as n,useSSRContext as T}from"vue";import{ssrRenderComponent as r}from"vue/server-renderer";import{useRouter as W,useRoute as B}from"vue-router";import{MglMap as X,MglNavigationControl as E,MglScaleControl as H,MglStyleSwitchControl as G,MglSymbolLayer as C}from"vue-maplibre-gl";import{_ as K}from"../server-entry.js";import"quasar";import"quasar/wrappers/index.mjs";import"pinia";import"quasar/icon-set/eva-icons.mjs";const k=8,I="https://api.wodore.com",L=F({__name:"MapView",__ssrInlineRender:!0,setup(Z){const d=W(),t=B(),a=J("_q_l_"),f=m("0"),y=m("0"),g=m("0"),h=m("0");a===void 0?console.error("MapView needs to be child of QLayout"):N(()=>{f.value=`${a.header.offset}px`,y.value=`${a.right.offset}px`,g.value=`${a.footer.offset}px`,h.value=`${a.left.offset}px`,console.log("layout",a),a&&(console.log("layout top: ",f.value),console.log("layout right: ",y.value),console.log("layout bottom: ",g.value),console.log("layout left: ",h.value))});const z=m("https://api.wodore.com/v1/huts/huts.geojson?lang=de&limit=5000&embed_all=false&embed_type=true&embed_owner=false&embed_capacity=false&embed_sources=false&include_elevation=false&include_name=true&flat=true"),v={"text-field":["get","name"],"text-size":["interpolate",["linear"],["zoom"],7,7,9,10,22,16],"text-font":["Open Sans Semibold"],"text-anchor":"bottom","icon-allow-overlap":!0,"text-allow-overlap":!1,"symbol-sort-key":["get","type_id"],"icon-overlap":"always","text-overlap":"never","text-optional":!0,"icon-image":["step",["zoom"],["coalesce",["image",["concat","wodore:simple/",["get","type_open_slug"]]],["image","wodore:simple/unknown"]],11,["coalesce",["image",["concat","wodore:detailed/",["get","type_open_slug"]]],["image","wodore:detailed/unknown"]]],"icon-size":["interpolate",["linear"],["zoom"],7,.1,9,.3,20,2],visibility:"visible"},w={"icon-opacity":["interpolate",["linear"],["zoom"],7,.7,12,.8,22,.85],"text-opacity":["step",["zoom"],0,9,1],"text-halo-width":2,"text-halo-color":"#ffffff","text-translate":["interpolate",["linear"],["zoom"],9,["literal",[0,-6]],20,["literal",[0,-40]]]},u=[{name:"swiss-vector",label:"Swisstopo",style:"https://api.maptiler.com/maps/ch-swisstopo-lbm-vivid/style.json?key=yYYuZy3hwmMjY087FDvY"},{name:"satellite",label:"Satellite",style:"https://api.maptiler.com/maps/hybrid/style.json?key=cQX2iET1gmOW38bedbUh"},{name:"outdoor-osm",label:"Outdoor OSM",style:"https://api.maptiler.com/maps/outdoor-v2/style.json?key=yYYuZy3hwmMjY087FDvY"}];function A(e){console.debug(`Maplibre version ${e.map.version} loaded`),e.map.scrollZoom.setWheelZoomRate(.003),R(e)}function b(e){if(console.debug("Hut layer clicked:",e),e.target.getZoom()>k){let l=e.features?.[0];if(console.debug("  Selected feature:",l),l){const s=l.properties.slug;t.params.slug==s?d.push({name:"map",hash:t.hash,query:t.query}):d.push({name:"map-hut",params:{slug:s},hash:t.hash,query:t.query})}}}function _(e){console.debug("Hut layer entered:",e),e.target.getZoom()>k&&(e.target.getCanvas().style.cursor="pointer")}function M(e){console.debug("Hut layer left:",e),e.target.getZoom()>k&&(e.target.getCanvas().style.cursor="")}const j=I+"/static/huts/sprite";function R(e){console.debug("Style data changed");const l=e.map.getSprite();console.debug("Check sprite 'wodore' in ",l);let s=!1;for(const S of l)S.id=="wodore"&&(s=!0);s||(console.debug(`Add sprite 'wodore' from '${j}'`),e.map.addSprite("wodore",j))}return(e,l,s,S)=>{const Y=q("MglGeolocationControl"),V=q("MglGeoJsonSource"),P={style:{"--3c2b5fd9":f.value,"--493cd203":h.value,"--465985b2":g.value,"--429860c0":y.value}};l(r(o(X),Q({language:"de","onMap:styledata":R,"onMap:load":A,hash:"p",zoom:7.5,center:[8.22,46.7],"map-style":u[0].style,style:{position:"fixed",right:"0px",top:"0",bottom:"0",left:"0"}},S,P),{default:x((oe,i,c,p)=>{if(i)i(r(Y,null,null,c,p)),i(r(o(E),null,null,c,p)),i(r(o(H),null,null,c,p)),i(r(o(G),{"map-styles":u,"map-style":u[0],position:"top-left"},null,c,p)),i(r(V,{"source-id":"huts",data:z.value},{default:x((te,$,U,D)=>{if($)$(r(o(C),{onClick:b,onMouseenter:_,onMouseleave:M,layout:v,paint:w,"layer-id":"huts"},null,U,D));else return[n(o(C),{onClick:b,onMouseenter:_,onMouseleave:M,layout:v,paint:w,"layer-id":"huts"})]}),_:1},c,p));else return[n(Y),n(o(E)),n(o(H)),n(o(G),{"map-styles":u,"map-style":u[0],position:"top-left"},null,8,["map-style"]),n(V,{"source-id":"huts",data:z.value},{default:x(()=>[n(o(C),{onClick:b,onMouseenter:_,onMouseleave:M,layout:v,paint:w,"layer-id":"huts"})]),_:1},8,["data"])]}),_:1},s))}}}),O=L.setup;L.setup=(Z,d)=>{const t=T();return(t.modules||(t.modules=new Set)).add("src/components/MapView.vue"),O?O(Z,d):void 0};const me=K(L,[["__file","MapView.vue"]]);export{me as default};
